<!-- index3.html -->
<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Akun Pembayaran</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gradient-to-br from-purple-50 to-pink-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      
      <!-- Header -->
      <div class="mb-8 text-center">
        <div class="bg-white rounded-2xl p-6 shadow-xl">
          <img
            src="https://tesdia.id/wp-content/uploads/2023/03/cropped-hanya-logo-DIA.webp"
            alt="Logo TesDIA"
            class="mx-auto mb-4 w-24 h-24 rounded-full shadow-lg"
          />
          <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">
            TesDIA Payment Manager
          </h1>
          <p class="text-lg text-gray-600">Dermatoglyphics, Intelligence, Analysis</p>
          <p class="text-sm text-gray-500 mt-1">Form Akun Pembayaran</p>
        </div>
      </div>

      <div class="max-w-4xl mx-auto">
        <div class="bg-white p-8 rounded-xl shadow-xl">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-4 border-purple-500 pb-3">
            üìù Form Akun Pembayaran
          </h2>
      <form id="akunForm" class="space-y-4">
        <div>
          <label for="nomorakun" class="block font-semibold mb-1"
            >Nomor Akun *</label
          >
          <input
            type="text"
            id="nomorakun"
            name="nomorakun"
            required
            class="w-full border px-3 py-2 rounded"
          />
        </div>
        <div>
          <label for="namalengkap" class="block font-semibold mb-1"
            >Nama Lengkap *</label
          >
          <input
            type="text"
            id="namalengkap"
            name="namalengkap"
            required
            class="w-full border px-3 py-2 rounded"
          />
        </div>
        <div>
          <label for="tanggaltes" class="block font-semibold mb-1"
            >Tanggal Tes *</label
          >
          <input
            type="date"
            id="tanggaltes"
            name="tanggaltes"
            required
            class="w-full border px-3 py-2 rounded"
          />
        </div>
        <div>
          <label for="tanggalbayar" class="block font-semibold mb-1"
            >Tanggal Bayar</label
          >
          <input
            type="date"
            id="tanggalbayar"
            name="tanggalbayar"
            class="w-full border px-3 py-2 rounded"
          />
        </div>
        <div>
          <label for="nominalbayar" class="block font-semibold mb-1"
            >Nominal Bayar *</label
          >
          <select
            id="nominalbayar"
            name="nominalbayar"
            required
            class="w-full border px-3 py-2 rounded"
          >
            <option value="">Pilih nominal</option>
            <option value="350000">Rp 350.000 (Lunas)</option>
            <option value="0">Rp 0 (Belum Lunas)</option>
          </select>
        </div>
        <div>
          <label for="alamat" class="block font-semibold mb-1">Alamat</label>
          <textarea
            id="alamat"
            name="alamat"
            rows="2"
            class="w-full border px-3 py-2 rounded"
          ></textarea>
        </div>
        <button
          type="submit"
          class="w-full bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700 transition"
        >
          Simpan
        </button>
      </form>
          <div id="resultMsg" class="mt-4 text-center"></div>
          
          <!-- Stats Cards -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 mb-6" id="statsAkun">
            <div class="bg-blue-100 text-blue-800 p-4 rounded-lg text-center">
              <div class="text-xl font-bold" id="totalAkun">0</div>
              <div class="text-sm opacity-90">Total Akun</div>
            </div>
            <div class="bg-green-100 text-green-800 p-4 rounded-lg text-center">
              <div class="text-xl font-bold" id="totalLunas">0</div>
              <div class="text-sm opacity-90">Total Lunas</div>
            </div>
            <div class="bg-red-100 text-red-800 p-4 rounded-lg text-center">
              <div class="text-xl font-bold" id="totalHutang">0</div>
              <div class="text-sm opacity-90">Total Hutang</div>
            </div>
            <div class="bg-yellow-100 text-yellow-800 p-4 rounded-lg text-center">
              <div class="text-xl font-bold" id="saldoAkun">Rp 0</div>
              <div class="text-sm opacity-90">Saldo</div>
            </div>
          </div>
          
          <div id="dataDisplay" class="mt-8 overflow-x-auto"></div>
        </div>
      </div>
        <!-- Floating Navigation -->
    <div id="floatingNav" class="fixed bottom-6 right-6 z-50">
      <!-- Main Menu Button -->
      <button
        id="menuToggle"
        class="w-14 h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-300 transform hover:scale-110"
        onclick="toggleMenu()"
      >
        <img
          src="https://img.icons8.com/ios-filled/24/ffffff/option.png"
          alt="Menu"
          class="w-6 h-6"
          id="menuIcon"
        />
      </button>

      <!-- Navigation Items -->
      <div
        id="navItems"
        class="absolute bottom-16 right-0 flex flex-col gap-3 opacity-0 pointer-events-none transition-all duration-300 transform scale-75"
      >
        <button
          class="w-12 h-12 bg-green-600 hover:bg-green-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 transform hover:scale-110"
          onclick="navigateToHome()"
          title="Home"
        >
          <img
            src="https://img.icons8.com/ios-filled/20/ffffff/home.png"
            alt="Home"
            class="w-5 h-5"
          />
        </button>

        <button
          class="w-12 h-12 bg-yellow-600 hover:bg-yellow-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 transform hover:scale-110"
          onclick="navigateToFinance()"
          title="Finance Document"
        >
          <img
            src="https://img.icons8.com/ios-glyphs/30/finance-medal.png"
            alt="Finance"
            class="w-5 h-5"
          />
        </button>

        <button
          class="w-12 h-12 bg-purple-600 hover:bg-purple-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 transform hover:scale-110"
          onclick="navigateToCustomer()"
          title="Customer Data"
        >
          <img
            width="32"
            height="32"
            src="https://img.icons8.com/external-solidglyph-m-oki-orlando/32/external-customer-data-customer-relationship-management-solid-solidglyph-m-oki-orlando.png"
            alt="external-customer-data-customer-relationship-management-solid-solidglyph-m-oki-orlando"
          />
        </button>

        <button
          class="w-12 h-12 bg-red-600 hover:bg-red-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 transform hover:scale-110"
          onclick="navigateToDebt()"
          title="Debt"
        >
          <img
            src="https://img.icons8.com/ios-filled/20/ffffff/debt.png"
            alt="Debt"
            class="w-5 h-5"
          />
        </button>
      </div>
    </div>

    <div
      id="navOverlay"
      class="fixed inset-0 z-40 hidden"
      onclick="closeMenu()"
    ></div>
    <script>
      let isMenuOpen = false;

      function toggleMenu() {
        const navItems = document.getElementById("navItems");
        const menuIcon = document.getElementById("menuIcon");
        const overlay = document.getElementById("navOverlay");

        isMenuOpen = !isMenuOpen;

        if (isMenuOpen) {
          // Show menu
          navItems.classList.remove(
            "opacity-0",
            "pointer-events-none",
            "scale-75"
          );
          navItems.classList.add(
            "opacity-100",
            "pointer-events-auto",
            "scale-100"
          );
          menuIcon.style.transform = "rotate(45deg)";
          overlay.classList.remove("hidden");
        } else {
          // Hide menu
          navItems.classList.add(
            "opacity-0",
            "pointer-events-none",
            "scale-75"
          );
          navItems.classList.remove(
            "opacity-100",
            "pointer-events-auto",
            "scale-100"
          );
          menuIcon.style.transform = "rotate(0deg)";
          overlay.classList.add("hidden");
        }
      }

      function closeMenu() {
        if (isMenuOpen) {
          toggleMenu();
        }
      }
      // Navigation functions
      function navigateToHome() {
        console.log("Navigate to Home");
        window.location.href = "index.html";
        closeMenu();
      }

      function navigateToFinance() {
        console.log("Navigate to Finance Document");
        window.location.href = "finance.html";
        closeMenu();
      }

      function navigateToCustomer() {
        console.log("Navigate to Customer Data");
        window.location.href = "customer.html";
        closeMenu();
      }

      function navigateToDebt() {
        console.log("Navigate to Debt");
        window.location.href = "hutang-piutang.html";
        closeMenu();
      }
      

      // Close menu when clicking outside
      document.addEventListener("click", function (event) {
        const floatingNav = document.getElementById("floatingNav");
        if (isMenuOpen && !floatingNav.contains(event.target)) {
          closeMenu();
        }
      });
      const APPS_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbwnwHBtoiPCK1NNtCjhry8p53tm2SyP-RxXyDgX8W7x2t23pkr21kPWPz1QjkSg2Exejg/exec";
      document
        .getElementById("akunForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const formData = new FormData(e.target);
          const data = {
            nomorakun: formData.get("nomorakun"),
            namalengkap: formData.get("namalengkap"),
            tanggaltes: formData.get("tanggaltes"),
            tanggalbayar: formData.get("tanggalbayar"),
            nominalbayar: formData.get("nominalbayar"),
            alamat: formData.get("alamat"),
          };
          document.getElementById("resultMsg").textContent = "Menyimpan...";
          try {
            const response = await fetch(APPS_SCRIPT_URL, {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body:
                "data=" +
                encodeURIComponent(JSON.stringify(data)) +
                "&sheet=akun",
            });
            const result = await response.json();
            if (result.success) {
              document.getElementById("resultMsg").textContent =
                "‚úÖ Data berhasil disimpan!";
              e.target.reset();
            } else {
              document.getElementById("resultMsg").textContent =
                "‚ùå Gagal menyimpan: " + result.message;
            }
          } catch (err) {
            document.getElementById("resultMsg").textContent =
              "‚ùå Error: " + err.message;
          }
        });

      // Data store
      let akunStore = [];
      let isOnline = navigator.onLine;
      let lastSyncTime = null;

      // Sync data from Google Sheets
      async function syncDataFromSheets(showIndicator = true) {
        try {
          if (showIndicator) {
            document.getElementById("resultMsg").textContent =
              "üîÑ Syncing data...";
          }
          const response = await fetch(
            APPS_SCRIPT_URL + "?action=get&sheet=akun",
            { method: "GET" }
          );
          if (response.ok) {
            const result = await response.json();
            if (result.success && result.data) {
              akunStore = result.data;
              updateDataDisplay();
              lastSyncTime = new Date();
              if (showIndicator) {
                document.getElementById("resultMsg").textContent =
                  "‚úÖ Sync sukses";
              }
            }
          } else {
            throw new Error("Failed to fetch data");
          }
        } catch (err) {
          document.getElementById("resultMsg").textContent =
            "‚ùå Sync error: " + err.message;
        }
      }

      // Tampilkan data ke tabel
      function updateDataDisplay() {
        const table = document.getElementById("dataDisplay");
        if (!akunStore.length) {
          table.innerHTML =
            '<div class="text-gray-500 text-center py-8 italic">Belum ada data akun pembayaran</div>';
          return;
        }
        const rows = akunStore
          .map(
            (d, i) => `
      <tr class="hover:bg-gray-50 transition-colors duration-200">
        <td class="px-2 py-2 text-xs">${i + 1}</td>
        <td class="px-2 py-2 text-xs">${d.nomorakun || "-"}</td>
        <td class="px-2 py-2 text-xs">${d.namalengkap || "-"}</td>
        <td class="px-2 py-2 text-xs">${d.tanggaltes || "-"}</td>
        <td class="px-2 py-2 text-xs">${d.tanggalbayar || "-"}</td>
        <td class="px-2 py-2 text-xs">${formatCurrency(d.nominalbayar)}</td>
        <td class="px-2 py-2 text-xs">${d.alamat || "-"}</td>
        <td class="px-2 py-2 text-xs font-semibold ${
          d.statuspembayaran === "Lunas" ? "text-green-600" : "text-red-600"
        }">${d.statuspembayaran || "-"}</td>
      </tr>
    `
          )
          .join("");
        table.innerHTML = `
      <div class="overflow-x-auto">
        <table class="min-w-full table-auto border-collapse bg-white rounded-lg overflow-hidden shadow-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-2 py-2 text-left text-xs font-semibold text-gray-600">#</th>
              <th class="px-2 py-2 text-left text-xs font-semibold text-gray-600">Nomor Akun</th>
              <th class="px-2 py-2 text-left text-xs font-semibold text-gray-600">Nama Lengkap</th>
              <th class="px-2 py-2 text-left text-xs font-semibold text-gray-600">Tanggal Tes</th>
              <th class="px-2 py-2 text-left text-xs font-semibold text-gray-600">Tanggal Bayar</th>
              <th class="px-2 py-2 text-left text-xs font-semibold text-gray-600">Nominal Bayar</th>
              <th class="px-2 py-2 text-left text-xs font-semibold text-gray-600">Alamat</th>
              <th class="px-2 py-2 text-left text-xs font-semibold text-gray-600">Status Pembayaran</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            ${rows}
          </tbody>
        </table>
      </div>
    `;
        updateStatsAkun();
      }

      // Format currency
      function formatCurrency(amount) {
        const num = parseInt(amount) || 0;
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0,
          maximumFractionDigits: 0,
        }).format(num);
      }

      // Sync saat halaman dibuka
      document.addEventListener("DOMContentLoaded", () => {
        syncDataFromSheets(true);
      });
      // Update stats
      function updateStatsAkun() {
        const totalAkun = akunStore.length;
        const totalLunas = akunStore.filter(
          (d) => d.statuspembayaran === "Lunas"
        ).length;
        const totalHutang = akunStore.filter(
          (d) => d.statuspembayaran === "Belum Lunas"
        ).length;
        const saldo = totalLunas * 350000 - totalHutang * 350000;

        document.getElementById("totalAkun").textContent = totalAkun;
        document.getElementById("totalLunas").textContent = totalLunas;
        document.getElementById("totalHutang").textContent = totalHutang;
        document.getElementById("saldoAkun").textContent =
          formatCurrency(saldo);
      }
    </script>
  </body>
</html>
