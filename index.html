<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Data Manager</title>

    <!-- Meta untuk mencegah indexing Google -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet" />
    <meta name="googlebot" content="noindex, nofollow" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <!-- Custom config untuk Tailwind -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#4facfe",
              secondary: "#00f2fe",
              accent: "#667eea",
              dark: "#764ba2",
            },
          },
        },
      };
    </script>

    <style>
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .gradient-primary {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .gradient-danger {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      }

      .glass {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
      <!-- Header -->
      <div
        class="gradient-primary rounded-2xl p-6 mb-6 text-center text-white shadow-2xl"
      >
        <h1 class="text-3xl md:text-4xl font-bold mb-2">üìä Data Manager</h1>
        <p class="text-lg opacity-90">Kelola data Anda dengan mudah</p>
      </div>

      <!-- Main Content -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Form Section -->
        <div class="bg-white rounded-2xl p-6 shadow-2xl">
          <h2
            class="text-2xl font-bold text-gray-800 mb-6 border-b-4 border-primary pb-3"
          >
            Input Data
          </h2>

          <!-- Success Message -->
          <div
            id="successMessage"
            class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-4"
          >
            <span class="font-medium">‚úÖ Data berhasil disimpan!</span>
          </div>

          <!-- Error Message -->
          <div
            id="errorMessage"
            class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4"
          >
            <span class="font-medium"
              >‚ùå Mohon lengkapi semua field yang diperlukan!</span
            >
          </div>

          <!-- Loading Message -->
          <div
            id="loadingMessage"
            class="hidden bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded-lg mb-4"
          >
            <span class="font-medium"
              >‚è≥ Menyimpan data ke Google Sheets...</span
            >
          </div>

          <form id="dataForm" class="space-y-4">
            <!-- Nama -->
            <div>
              <label
                for="nama"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Nama Lengkap *
              </label>
              <input
                type="text"
                id="nama"
                name="nama"
                required
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              />
            </div>

            <!-- No HP -->
            <div>
              <label
                for="nohp"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                No. HP *
              </label>
              <input
                type="tel"
                id="nohp"
                name="nohp"
                required
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              />
            </div>

            <!-- Sekolah -->
            <div>
              <label
                for="sekolah"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Sekolah *
              </label>
              <input
                type="text"
                id="sekolah"
                name="sekolah"
                required
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              />
            </div>

            <!-- Indikasi -->
            <div>
              <label
                for="indikasi"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Indikasi *
              </label>
              <select
                id="indikasi"
                name="indikasi"
                required
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              >
                <option value="">Pilih indikasi</option>
                <option value="positif">Positif</option>
                <option value="negatif">Negatif</option>
              </select>
            </div>

            <!-- Keterangan -->
            <div>
              <label
                for="keterangan"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Keterangan
              </label>
              <textarea
                id="keterangan"
                name="keterangan"
                rows="2"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200 resize-none"
              ></textarea>
            </div>

            <!-- Follow Up -->
            <div>
              <label
                for="followup"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Follow Up
              </label>
              <textarea
                id="followup"
                name="followup"
                rows="2"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200 resize-none"
              ></textarea>
            </div>

            <!-- Buttons -->
            <div class="flex flex-col sm:flex-row gap-3 pt-4">
              <button
                type="submit"
                class="gradient-primary text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2"
              >
                <span>üíæ</span>
                Simpan Data
              </button>
              <button
                type="button"
                onclick="clearForm()"
                class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2"
              >
                <span>üóëÔ∏è</span>
                Clear Form
              </button>
            </div>
          </form>
        </div>

        <!-- Data Section -->
        <div class="bg-white rounded-2xl p-6 shadow-2xl">
          <h2
            class="text-2xl font-bold text-gray-800 mb-6 border-b-4 border-primary pb-3"
          >
            Data Tersimpan
          </h2>

          <!-- Stats Cards -->
          <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
            <div class="gradient-bg text-white p-4 rounded-lg text-center">
              <div class="text-2xl font-bold" id="totalData">0</div>
              <div class="text-sm opacity-90">Total Data</div>
            </div>
            <div class="gradient-primary text-white p-4 rounded-lg text-center">
              <div class="text-2xl font-bold" id="totalPositif">0</div>
              <div class="text-sm opacity-90">Positif</div>
            </div>
            <div
              class="bg-green-500 text-white p-4 rounded-lg text-center col-span-2 md:col-span-1"
            >
              <div class="text-2xl font-bold" id="totalNegatif">0</div>
              <div class="text-sm opacity-90">Negatif</div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex flex-col sm:flex-row gap-3 mb-6">
            <button
              onclick="syncWithGoogleSheets()"
              class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2 text-sm"
            >
              <span>üîÑ</span>
              Sync Google Sheets
            </button>
            <button
              onclick="exportData()"
              class="gradient-primary text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2 text-sm"
            >
              <span>üì§</span>
              Export JSON
            </button>
            <button
              onclick="importData()"
              class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2 text-sm"
            >
              <span>üì•</span>
              Import JSON
            </button>
            <button
              onclick="clearAllData()"
              class="gradient-danger text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2 text-sm"
            >
              <span>üóëÔ∏è</span>
              Hapus Semua
            </button>
          </div>

          <input
            type="file"
            id="fileInput"
            accept=".json"
            class="hidden"
            onchange="handleFileImport(event)"
          />

          <!-- Data Display -->
          <div id="dataDisplay" class="overflow-x-auto"></div>
        </div>
      </div>
    </div>

    <script>
      // GANTI URL INI DENGAN URL APPS SCRIPT ANDA
      const APPS_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbxlw9YODDCAfTinTiJ03AgDI14p2vusoib5s0qqHm-gcfMWC4-vhIv6Bp_5pmxGSesB/exec";

      // Data storage (hybrid: localStorage + Google Sheets)
      let dataStore = JSON.parse(localStorage.getItem("userData") || "[]");
      let isOnline = navigator.onLine;

      // Form submission
      document
        .getElementById("dataForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const formData = new FormData(e.target);
          const data = {
            id: Date.now(),
            timestamp: new Date().toLocaleString("id-ID"),
            nama: formData.get("nama"),
            nohp: formData.get("nohp"),
            sekolah: formData.get("sekolah"),
            indikasi: formData.get("indikasi"),
            keterangan: formData.get("keterangan"),
            followup: formData.get("followup"),
          };

          // Validasi
          if (!data.nama || !data.nohp || !data.sekolah || !data.indikasi) {
            showMessage("errorMessage");
            return;
          }

          // Tampilkan loading
          showLoading(true);

          try {
            // Simpan ke Google Sheets
            const response = await fetch(APPS_SCRIPT_URL, {
              method: "POST",
              mode: "no-cors",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            });

            // Simpan juga ke localStorage sebagai backup
            dataStore.push(data);
            localStorage.setItem("userData", JSON.stringify(dataStore));

            // Reset form dan update display
            e.target.reset();
            showMessage("successMessage");
            updateDataDisplay();
          } catch (error) {
            console.error("Error:", error);
            // Jika gagal ke Google Sheets, tetap simpan ke localStorage
            dataStore.push(data);
            localStorage.setItem("userData", JSON.stringify(dataStore));

            e.target.reset();
            showMessage("successMessage");
            updateDataDisplay();
          } finally {
            showLoading(false);
          }
        });

      function showMessage(messageId) {
        const message = document.getElementById(messageId);
        message.classList.remove("hidden");
        setTimeout(() => {
          message.classList.add("hidden");
        }, 3000);
      }

      function showLoading(show) {
        const loadingMessage = document.getElementById("loadingMessage");
        if (show) {
          loadingMessage.classList.remove("hidden");
        } else {
          loadingMessage.classList.add("hidden");
        }
      }

      async function syncWithGoogleSheets() {
        showLoading(true);
        try {
          const response = await fetch(APPS_SCRIPT_URL, {
            method: "GET",
            mode: "no-cors",
          });

          // Karena mode no-cors, kita tidak bisa membaca response
          // Jadi kita hanya beri notifikasi bahwa sync dimulai
          alert(
            "Sync dengan Google Sheets dimulai. Cek spreadsheet Anda untuk memastikan data tersinkronisasi."
          );
        } catch (error) {
          console.error("Error syncing:", error);
          alert(
            "Gagal melakukan sync dengan Google Sheets. Pastikan URL Apps Script sudah benar."
          );
        } finally {
          showLoading(false);
        }
      }

      function clearForm() {
        document.getElementById("dataForm").reset();
      }

      function updateDataDisplay() {
        const display = document.getElementById("dataDisplay");

        if (dataStore.length === 0) {
          display.innerHTML =
            '<div class="text-center text-gray-500 py-8 italic">Belum ada data yang tersimpan</div>';
          updateStats();
          return;
        }

        let html = '<div class="overflow-x-auto">';
        html +=
          '<table class="min-w-full bg-white rounded-lg overflow-hidden shadow-lg">';
        html += '<thead class="gradient-bg text-white">';
        html += "<tr>";
        html +=
          '<th class="px-4 py-3 text-left text-sm font-semibold">Timestamp</th>';
        html +=
          '<th class="px-4 py-3 text-left text-sm font-semibold">Nama</th>';
        html +=
          '<th class="px-4 py-3 text-left text-sm font-semibold hidden sm:table-cell">No. HP</th>';
        html +=
          '<th class="px-4 py-3 text-left text-sm font-semibold hidden md:table-cell">Sekolah</th>';
        html +=
          '<th class="px-4 py-3 text-left text-sm font-semibold">Indikasi</th>';
        html +=
          '<th class="px-4 py-3 text-center text-sm font-semibold">Aksi</th>';
        html += "</tr>";
        html += "</thead>";
        html += '<tbody class="divide-y divide-gray-200">';

        dataStore.forEach((item) => {
          const indikasiColor =
            item.indikasi === "positif"
              ? "bg-red-100 text-red-800"
              : "bg-green-100 text-green-800";
          html += `<tr class="hover:bg-gray-50 transition-colors duration-200">
                    <td class="px-4 py-3 text-sm text-gray-600">${item.timestamp}</td>
                    <td class="px-4 py-3 text-sm font-medium text-gray-900">${item.nama}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 hidden sm:table-cell">${item.nohp}</td>
                    <td class="px-4 py-3 text-sm text-gray-600 hidden md:table-cell">${item.sekolah}</td>
                    <td class="px-4 py-3">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${indikasiColor}">
                            ${item.indikasi}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-center">
                        <div class="flex justify-center space-x-2">
                            <button onclick="viewDetails(${item.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs font-medium transition-colors duration-200">
                                üëÅÔ∏è
                            </button>
                            <button onclick="deleteData(${item.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs font-medium transition-colors duration-200">
                                üóëÔ∏è
                            </button>
                        </div>
                    </td>
                </tr>`;
        });

        html += "</tbody></table></div>";
        display.innerHTML = html;
        updateStats();
      }

      function updateStats() {
        document.getElementById("totalData").textContent = dataStore.length;
        document.getElementById("totalPositif").textContent = dataStore.filter(
          (item) => item.indikasi === "positif"
        ).length;
        document.getElementById("totalNegatif").textContent = dataStore.filter(
          (item) => item.indikasi === "negatif"
        ).length;
      }

      function viewDetails(id) {
        const item = dataStore.find((data) => data.id === id);
        if (item) {
          // Create a more mobile-friendly modal
          const modal = document.createElement("div");
          modal.className =
            "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50";
          modal.innerHTML = `
                    <div class="bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
                        <h3 class="text-lg font-bold mb-4 text-gray-800">Detail Data</h3>
                        <div class="space-y-3">
                            <div><strong>Nama:</strong> ${item.nama}</div>
                            <div><strong>No. HP:</strong> ${item.nohp}</div>
                            <div><strong>Sekolah:</strong> ${item.sekolah}</div>
                            <div><strong>Indikasi:</strong> 
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                  item.indikasi === "positif"
                                    ? "bg-red-100 text-red-800"
                                    : "bg-green-100 text-green-800"
                                }">
                                    ${item.indikasi}
                                </span>
                            </div>
                            <div><strong>Keterangan:</strong> ${
                              item.keterangan || "Tidak ada"
                            }</div>
                            <div><strong>Follow Up:</strong> ${
                              item.followup || "Tidak ada"
                            }</div>
                            <div><strong>Timestamp:</strong> ${
                              item.timestamp
                            }</div>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" class="mt-4 w-full bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-semibold transition-colors duration-200">
                            Tutup
                        </button>
                    </div>
                `;
          document.body.appendChild(modal);

          // Close modal when clicking outside
          modal.addEventListener("click", function (e) {
            if (e.target === modal) {
              modal.remove();
            }
          });
        }
      }

      function deleteData(id) {
        if (confirm("Apakah Anda yakin ingin menghapus data ini?")) {
          dataStore = dataStore.filter((item) => item.id !== id);
          localStorage.setItem("userData", JSON.stringify(dataStore));
          updateDataDisplay();
        }
      }

      function clearAllData() {
        if (
          confirm(
            "Apakah Anda yakin ingin menghapus SEMUA data? Tindakan ini tidak dapat dibatalkan!"
          )
        ) {
          dataStore = [];
          localStorage.setItem("userData", JSON.stringify(dataStore));
          updateDataDisplay();
        }
      }

      function exportData() {
        if (dataStore.length === 0) {
          alert("Tidak ada data untuk diekspor");
          return;
        }

        const dataStr = JSON.stringify(dataStore, null, 2);
        const dataBlob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `data_backup_${
          new Date().toISOString().split("T")[0]
        }.json`;
        link.click();
        URL.revokeObjectURL(url);
      }

      function importData() {
        document.getElementById("fileInput").click();
      }

      function handleFileImport(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const importedData = JSON.parse(e.target.result);
            if (Array.isArray(importedData)) {
              if (
                confirm(
                  "Import data akan menggantikan data yang ada. Lanjutkan?"
                )
              ) {
                dataStore = importedData;
                localStorage.setItem("userData", JSON.stringify(dataStore));
                updateDataDisplay();
                alert("Data berhasil diimport!");
              }
            } else {
              alert("Format file tidak valid");
            }
          } catch (error) {
            alert("Error membaca file: " + error.message);
          }
        };
        reader.readAsText(file);
      }

      // Initialize display
      updateDataDisplay();
    </script>
  </body>
</html>
