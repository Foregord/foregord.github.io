<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      type="image/x-icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>"
    />
    <title>TESDIA DATA MANAGER</title>
    <!-- Meta untuk mencegah indexing Google -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet" />
    <meta name="googlebot" content="noindex, nofollow" />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .gradient-primary {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .gradient-danger {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      }

      .glass {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
      <!-- Header -->
      <div
        class="gradient-primary rounded-2xl p-6 mb-6 text-center text-white shadow-2xl"
      >
        <img
          src="https://tesdia.id/wp-content/uploads/2023/03/cropped-hanya-logo-DIA.webp"
          alt="Logo Tesdia"
          class="mx-auto mb-4 w-24 h-24 rounded-full shadow-lg"
        />
        <h1 class="text-3xl md:text-4xl font-bold mb-2">
          Tesdia Data Manager Bandung
        </h1>
      </div>

      <!-- Main Content -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Form Section -->
        <div class="bg-white rounded-2xl p-6 shadow-2xl">
          <h2
            class="text-2xl font-bold text-gray-800 mb-6 border-b-4 border-primary pb-3"
          >
            Input Data
          </h2>
          <!-- Success Message -->
          <div
            id="successMessage"
            class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-4"
          >
            <span class="font-medium">‚úÖ Data berhasil disimpan!</span>
          </div>
          <!-- Error Message -->
          <div
            id="errorMessage"
            class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4"
          >
            <span class="font-medium"
              >‚ùå Mohon lengkapi semua field yang diperlukan!</span
            >
          </div>
          <!-- Loading Message -->
          <div
            id="loadingMessage"
            class="hidden bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded-lg mb-4"
          >
            <span class="font-medium"
              >‚è≥ Menyimpan data ke Google Sheets...</span
            >
          </div>

          <form id="dataForm" class="space-y-4">
            <!-- Nama -->
            <div>
              <label
                for="nama"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Nama Lengkap *
              </label>
              <input
                type="text"
                id="nama"
                name="nama"
                required
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              />
            </div>

            <!-- No HP -->
            <div>
              <label
                for="nohp"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                No. HP *
              </label>
              <input
                type="tel"
                id="nohp"
                name="nohp"
                required
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              />
            </div>

            <!-- Sekolah -->
            <div>
              <label
                for="sekolah"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Sekolah *
              </label>
              <input
                type="text"
                id="sekolah"
                name="sekolah"
                required
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              />
            </div>

            <!-- Jabatan -->
            <div>
              <label
                for="jabatan"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Jabatan
              </label>
              <input
                type="text"
                id="jabatan"
                name="jabatan"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              />
            </div>

            <!-- Tipe Jari -->
            <div>
              <label
                for="tipejari"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Tipe Jari *
              </label>
              <select
                id="tipejari"
                name="tipejari"
                required
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              >
                <option value="" disabled selected hidden>
                  Pilih tipe jari
                </option>
                <option value="jempol" disabled selected hidden>Jempol</option>
                <option value="telunjuk" disabled selected hidden>
                  Telunjuk
                </option>
                <option value="tengah" disabled selected hidden>Tengah</option>
                <option value="manis" disabled selected hidden>Manis</option>
                <option value="kelingking" disabled selected hidden>
                  Kelingking
                </option>
                <option value="Belum di tes" disabled selected hidden>
                  Belum di tes
                </option>
              </select>
            </div>

            <!-- Indikasi -->
            <div>
              <label
                for="indikasi"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Indikasi *
              </label>
              <select
                id="indikasi"
                name="indikasi"
                required
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              >
                <option value="" disabled selected hidden>
                  Pilih indikasi
                </option>
                <option value="positif" disabled selected hidden>
                  Positif
                </option>
                <option value="negatif" disabled selected hidden>
                  Negatif
                </option>
              </select>
            </div>

            <!-- Keterangan -->
            <div>
              <label
                for="keterangan"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Keterangan
              </label>
              <select
                id="keterangan"
                name="keterangan"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              >
                <option value="" disabled selected hidden>
                  Pilih keterangan
                </option>
                <option value="Seminar Parenting" disabled selected hidden>
                  Seminar Parenting
                </option>
                <option value="Seminar Guru-Guru" disabled selected hidden>
                  Seminar Guru-Guru
                </option>
                <option value="Workshop" disabled selected hidden>
                  Workshop
                </option>
                <option value="Sosialisasi" disabled selected hidden>
                  Sosialisasi
                </option>
                <option value="Pengetesan" disabled selected hidden>
                  Pengetesan
                </option>
              </select>
            </div>

            <!-- Follow Up -->
            <div>
              <label
                for="followup"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Follow Up Date
              </label>
              <input
                type="date"
                id="followup"
                name="followup"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-200"
              />
            </div>

            <!-- Buttons -->
            <div class="flex flex-col sm:flex-row gap-3 pt-4">
              <button
                type="submit"
                class="gradient-primary text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2"
              >
                <span>üíæ</span>
                Simpan Data
              </button>
              <button
                type="button"
                onclick="clearForm()"
                class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2"
              >
                <span>üóëÔ∏è</span>
                Clear Form
              </button>
            </div>
          </form>
        </div>

        <!-- Data Section -->
        <div class="bg-white rounded-2xl p-6 shadow-2xl">
          <h2
            class="text-2xl font-bold text-gray-800 mb-6 border-b-4 border-primary pb-3"
          >
            Data Tersimpan
          </h2>

          <!-- Stats Cards -->
          <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
            <div class="gradient-bg text-white p-4 rounded-lg text-center">
              <div class="text-2xl font-bold" id="totalData">0</div>
              <div class="text-sm opacity-90">Total Data</div>
            </div>
            <div class="gradient-primary text-white p-4 rounded-lg text-center">
              <div class="text-2xl font-bold" id="totalPositif">0</div>
              <div class="text-sm opacity-90">Positif</div>
            </div>
            <div
              class="bg-green-500 text-white p-4 rounded-lg text-center col-span-2 md:col-span-1"
            >
              <div class="text-2xl font-bold" id="totalNegatif">0</div>
              <div class="text-sm opacity-90">Negatif</div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex flex-col sm:flex-row gap-3 mb-6">
            <button
              onclick="exportData()"
              class="gradient-primary text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2 text-sm"
            >
              <span>üì§</span>
              Export JSON
            </button>
            <button
              onclick="importData()"
              class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2 text-sm"
            >
              <span>üì•</span>
              Import JSON
            </button>
            <button
              onclick="clearAllData()"
              class="gradient-danger text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2 text-sm"
            >
              <span>üóëÔ∏è</span>
              Hapus Semua
            </button>
          </div>

          <input
            type="file"
            id="fileInput"
            accept=".json"
            class="hidden"
            onchange="handleFileImport(event)"
          />

          <!-- Data Display -->
          <div id="dataDisplay" class="overflow-x-auto"></div>
        </div>
      </div>
    </div>

    <script>
      const APPS_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbz6A6-HfkCFlNCKbU2sJaUWVzOoL-emKKsgfUb6191ZPMsmEoyTfmoel7FsJ9zWqu1-bw/exec";

      let dataStore = [];

      document.addEventListener("DOMContentLoaded", async () => {
        await syncDataFromSheets();
        updateDataDisplay();
      });

      document
        .getElementById("dataForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);

          const data = {
            id: Date.now(),
            timestamp: new Date().toLocaleString("id-ID"),
            nama: formData.get("nama"),
            nohp: formData.get("nohp"),
            sekolah: formData.get("sekolah"),
            jabatan: formData.get("jabatan"),
            tipejari: formData.get("tipejari"),
            indikasi: formData.get("indikasi"),
            keterangan: formData.get("keterangan"),
            followup: formData.get("followup"),
          };

          if (
            !data.nama ||
            !data.nohp ||
            !data.sekolah ||
            !data.tipejari ||
            !data.indikasi
          ) {
            console.warn("Validasi gagal", data);
            showMessage("errorMessage");
            return;
          }

          showMessage("loadingMessage");

          try {
            await saveToGoogleSheets(data);
            dataStore.push(data);
            e.target.reset();
            updateDataDisplay();
            showMessage("successMessage");
          } catch (err) {
            console.error(err);
            showMessage("errorMessage");
          }
        });

      async function saveToGoogleSheets(data) {
        const response = await fetch(APPS_SCRIPT_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: "data=" + encodeURIComponent(JSON.stringify(data)),
        });

        const result = await response.json();
        if (!result.success) {
          throw new Error(result.message || "Gagal menyimpan ke Google Sheets");
        }
      }

      async function syncDataFromSheets() {
        try {
          const response = await fetch(APPS_SCRIPT_URL);
          const result = await response.json();
          if (result.success) {
            dataStore = result.data || [];
          }
        } catch (err) {
          console.warn("Gagal mengambil data dari Google Sheets:", err);
        }
      }

      function updateDataDisplay() {
        const table = document.getElementById("dataDisplay");
        if (dataStore.length === 0) {
          table.innerHTML = `<div class="text-gray-500 text-center py-4 italic">Belum ada data tersimpan</div>`;
          updateStats();
          return;
        }

        const rows = dataStore.map((d) => {
          const indikasiColor =
            d.indikasi === "positif"
              ? "bg-red-100 text-red-800"
              : "bg-green-100 text-green-800";
          return `
            <tr class="hover:bg-gray-50 transition">
              <td class="px-4 py-2 text-sm">${d.timestamp}</td>
              <td class="px-4 py-2 text-sm">${d.nama}</td>
              <td class="px-4 py-2 text-sm">${d.nohp}</td>
              <td class="px-4 py-2 text-sm">${d.sekolah}</td>
              <td class="px-4 py-2 text-sm">${d.jabatan || "-"}</td>
              <td class="px-4 py-2 text-sm">${d.tipejari}</td>
              <td class="px-4 py-2">
                <span class="inline-block px-2 py-1 text-xs rounded-full ${indikasiColor}">${
            d.indikasi
          }</span>
              </td>
            </tr>
          `;
        });

        table.innerHTML = `
          <table class="min-w-full table-auto border-collapse rounded-lg overflow-hidden">
            <thead class="bg-gray-200 text-gray-700">
              <tr>
                <th class="px-4 py-2 text-left">Waktu</th>
                <th class="px-4 py-2 text-left">Nama</th>
                <th class="px-4 py-2 text-left">No HP</th>
                <th class="px-4 py-2 text-left">Sekolah</th>
                <th class="px-4 py-2 text-left">Jabatan</th>
                <th class="px-4 py-2 text-left">Tipe Jari</th>
                <th class="px-4 py-2 text-left">Indikasi</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              ${rows.join("")}
            </tbody>
          </table>
        `;

        updateStats();
      }

      function updateStats() {
        const totalData = dataStore.length;
        const totalPositif = dataStore.filter(
          (d) => d.indikasi === "positif"
        ).length;
        const totalNegatif = dataStore.filter(
          (d) => d.indikasi === "negatif"
        ).length;

        document.getElementById("totalData").textContent = totalData;
        document.getElementById("totalPositif").textContent = totalPositif;
        document.getElementById("totalNegatif").textContent = totalNegatif;
      }

      function showMessage(id) {
        ["successMessage", "errorMessage", "loadingMessage"].forEach((el) => {
          document.getElementById(el).classList.add("hidden");
        });
        const el = document.getElementById(id);
        if (el) {
          el.classList.remove("hidden");
          if (id !== "loadingMessage") {
            setTimeout(() => el.classList.add("hidden"), 3000);
          }
        }
      }

      function clearForm() {
        document.getElementById("dataForm").reset();
      }
    </script>
  </body>
</html>
